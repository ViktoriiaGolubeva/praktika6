#include <8051.h>

// ??????? ???????? ??????? ?? ????????????????? ?????
void tput(unsigned char c1)
{
  SBUF = c1; // ??????? ?????? ? ????? ????????
  while (!TI); // ??????? ????????? ????????
  TI = 0; // ?????????? ???? ????????? ????????
}

void main()
{
  unsigned char data[] = { 0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF };
  unsigned char receive_char;
  unsigned char *write_ptr = 0x30;

  // ??????????? ???? ? ????? 11-??????? ????? ?? ????????? 375 ????/?
  SCON = 0x82;

  // ??????????? ???????? ????????/??????
  TMOD &= 0x0F;
  TMOD |= 0x20;
  TH1 = 0xFD;
  TL1 = 0xFD;

  // ????????? ?????????? ?? ?????????
  RI = 0;
  TI = 0;
  TR1 = 1;
  ES = 1;

  // ?????????? ??????
  for (int i = 0; i < 8; i++) {
    tput(data[i]);
  }

  // ??????????? ???? ???????? ????? ???????? ?? ????????? ? ?? ?????? ? ?????? ??
  while (1) {
    while (!RI); // ??????? ?????? ???????
    receive_char = SBUF; // ???????? ?????? ?? ?????? ??????
    RI = 0; // ?????????? ???? ??????
    *write_ptr = receive_char; // ?????????? ?????? ? ?????? ??
    write_ptr++; // ??????????? ????????? ?? ????????? ?????? ??????
  }
}
